let
    Source = Excel.CurrentWorkbook(){[Name="Output"]}[Content],
    #"Removed Columns" = Table.RemoveColumns(Source,{"Process?", "Payload", "ShipType.Commodity"}),
    #"Filtered Rows" = Table.SelectRows(#"Removed Columns", each ([Result] <> null)),
    #"Parsed JSON" = Table.TransformColumns(#"Filtered Rows",{{"Result", Json.Document}}),
    #"Expanded Result" = Table.ExpandRecordColumn(#"Parsed JSON", "Result", {"output", "errors"}, {"output", "errors"}),
    #"Expanded output" = Table.ExpandRecordColumn(#"Expanded Result", "output", {"transitTimes"}, {"transitTimes"}),
    #"Expanded transitTimes" = Table.ExpandListColumn(#"Expanded output", "transitTimes"),
    #"Expanded transitTimes1" = Table.ExpandRecordColumn(#"Expanded transitTimes", "transitTimes", {"transitTimeDetails"}, {"transitTimeDetails"}),
    #"Expanded transitTimeDetails" = Table.ExpandListColumn(#"Expanded transitTimes1", "transitTimeDetails"),
    #"Expanded transitTimeDetails1" = Table.ExpandRecordColumn(#"Expanded transitTimeDetails", "transitTimeDetails", {"serviceType", "commit", "customerMessages"}, {"serviceType", "commit", "customerMessages"}),
    #"Expanded commit" = Table.ExpandRecordColumn(#"Expanded transitTimeDetails1", "commit", {"dateDetail", "commodityName"}, {"dateDetail", "commodityName"}),
    #"Expanded dateDetail" = Table.ExpandRecordColumn(#"Expanded commit", "dateDetail", {"time", "day"}, {"time", "day"}),
    #"Expanded errors" = Table.ExpandListColumn(#"Expanded dateDetail", "errors"),
    #"Expanded errors1" = Table.ExpandRecordColumn(#"Expanded errors", "errors", {"message"}, {"message"}),
    #"Replaced Value" = Table.ReplaceValue(#"Expanded errors1","INTERNATIONAL_PRIORITY","IP",Replacer.ReplaceText,{"serviceType"}),
    #"Expanded customerMessages" = Table.ExpandListColumn(#"Replaced Value", "customerMessages"),
    #"Expanded customerMessages1" = Table.ExpandRecordColumn(#"Expanded customerMessages", "customerMessages", {"message"}, {"customerMessages"}),
    #"Filtered Rows1" = Table.SelectRows(#"Expanded customerMessages1", each ([customerMessages] <> "0")),
    #"Replaced Value5" = Table.ReplaceValue(#"Filtered Rows1","134","",Replacer.ReplaceText,{"customerMessages"}),
    #"Replaced Value1" = Table.ReplaceValue(#"Replaced Value5","INTERNATIONAL_ECONOMY","IE",Replacer.ReplaceText,{"serviceType"}),
    #"Replaced Value2" = Table.ReplaceValue(#"Replaced Value1","IP_FREIGHT","IPF",Replacer.ReplaceText,{"serviceType"}),
    #"Replaced Value3" = Table.ReplaceValue(#"Replaced Value2","IE_FREIGHT","IEF",Replacer.ReplaceText,{"serviceType"}),
    #"Replaced Value4" = Table.ReplaceValue(#"Replaced Value3","INTERNATIONAL_FIRST","IF",Replacer.ReplaceText,{"serviceType"}),
    #"Merged Columns" = Table.CombineColumns(#"Replaced Value4",{"ShipDate.Year", "ShipDate.Month", "ShipDate.Day"},Combiner.CombineTextByDelimiter("/", QuoteStyle.None),"ShipDate"),
    #"Changed Type" = Table.TransformColumnTypes(#"Merged Columns",{{"ShipDate", type date}, {"day", type date}}),
    #"Added Custom" = Table.AddColumn(#"Changed Type", "TT", each [day]-[ShipDate]),
    #"Changed Type1" = Table.TransformColumnTypes(#"Added Custom",{{"TT", Int64.Type}}),
    #"Renamed Columns" = Table.RenameColumns(#"Changed Type1",{{"serviceType", "Product"}, {"time", "DeliveryTime"}, {"day", "DeliveryDate"}, {"commodityName", "Commodity"}, {"message", "Error"}}),
    #"Merged Columns1" = Table.CombineColumns(Table.TransformColumnTypes(#"Renamed Columns", {{"Error", type text}}, "en-HK"),{"Error", "customerMessages"},Combiner.CombineTextByDelimiter("", QuoteStyle.None),"Error"),
    #"Reordered Columns" = Table.ReorderColumns(#"Merged Columns1",{"Origin.Country", "Origin.City", "Origin.Postal", "Destination.Country", "Destination.City", "Destination.Postal", "ShipType.Value", "ShipType.Currency", "ShipType.Packaging", "ShipType.Weight", "ShipType.WUnit", "Commodity", "Product", "ShipDate", "DeliveryDate", "DeliveryTime", "TT", "Error"})
in
    #"Reordered Columns"
